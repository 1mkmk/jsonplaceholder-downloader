#!/bin/bash
# =======================================================
# Script to run JSONPlaceholder Downloader application
# Generated by Ansible on {{ ansible_date_time.date }}
# =======================================================

# Application information
APP_NAME="{{ app_name }}"
APP_VERSION="{{ app_version }}"
APP_JAR="{{ app_dir }}/{{ app_name }}.jar"
APP_CONFIG="{{ app_config_dir }}/application.properties"
APP_LOG="{{ app_log_dir }}/console.log"

# Change to app directory
cd "{{ app_dir }}" || exit 1

# JVM options
JAVA_OPTS="-Xms256m -Xmx512m -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath={{ app_log_dir }} -Dspring.config.location=$APP_CONFIG {{ jvm_extra_opts | default('') }}"

# Log startup
echo "[$(date '+%Y-%m-%d %H:%M:%S')] Starting $APP_NAME version $APP_VERSION" >> "$APP_LOG"

# Check if Java is installed
if ! command -v java &> /dev/null; then
    echo "Error: Java is not installed or not in PATH" | tee -a "$APP_LOG"
    exit 1
fi

# Check if jar file exists
if [ ! -f "$APP_JAR" ]; then
    echo "Error: Application JAR file not found at $APP_JAR" | tee -a "$APP_LOG"
    exit 1
fi

# Start the application
echo "Starting $APP_NAME with options: $JAVA_OPTS" >> "$APP_LOG"
exec java $JAVA_OPTS -jar "$APP_JAR"